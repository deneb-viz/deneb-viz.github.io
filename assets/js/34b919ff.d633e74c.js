"use strict";(self.webpackChunkdeneb_doc=self.webpackChunkdeneb_doc||[]).push([[9511],{10872:e=>{e.exports=JSON.parse('{"permalink":"/blog/stacked-bar-alternative","source":"@site/blog/2025-04-08-d.mdx","title":"How-To: The Stacked Bar Alternative","description":"Using Vega-Lite to replicate a more readable alternative to a stacked bar chart.","date":"2025-04-08T00:00:00.000Z","tags":[{"inline":true,"label":"how-to","permalink":"/blog/tags/how-to"},{"inline":true,"label":"vega-lite","permalink":"/blog/tags/vega-lite"}],"readingTime":17.295,"hasTruncateMarker":true,"authors":[{"name":"Daniel Marsh-Patrick","title":"Program Manager & Developer","url":"https://github.com/dm-p","imageURL":"https://github.com/dm-p.png","key":"daniel","page":null}],"frontMatter":{"title":"How-To: The Stacked Bar Alternative","description":"Using Vega-Lite to replicate a more readable alternative to a stacked bar chart.","slug":"stacked-bar-alternative","authors":["daniel"],"tags":["how-to","vega-lite"],"image":"/img/blog/2025-04-08-stacked-bar/finished-recipe.png","hide_table_of_contents":false},"unlisted":false,"nextItem":{"title":"Deneb Annual Round-Up","permalink":"/blog/2024-2025-summary"}}')},11389:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/files/Stacked Bar Chart Alternative.deneb-52f8b086155a624eaaef20973fd8d67b.json"},34882:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>g,frontMatter:()=>l,metadata:()=>a,toc:()=>h});var a=t(10872),r=t(74848),s=t(28453),i=t(22019);const l={title:"How-To: The Stacked Bar Alternative",description:"Using Vega-Lite to replicate a more readable alternative to a stacked bar chart.",slug:"stacked-bar-alternative",authors:["daniel"],tags:["how-to","vega-lite"],image:"/img/blog/2025-04-08-stacked-bar/finished-recipe.png",hide_table_of_contents:!1},d=void 0,o={authorsImageUrls:[void 0]},h=[{value:"Finished Recipe",id:"finished-recipe",level:2},{value:"Our Data",id:"our-data",level:2},{value:"Thinking About Our Design",id:"thinking-about-our-design",level:2},{value:"Step 1: Highest Level Grouping",id:"step-1-highest-level-grouping",level:2},{value:"Step 2: Lowest Level Grouping",id:"step-2-lowest-level-grouping",level:2},{value:"Step 3: Cleaning Up the Plot Area",id:"step-3-cleaning-up-the-plot-area",level:2},{value:"Step 4: Labels",id:"step-4-labels",level:2},{value:"Wrapping Up",id:"wrapping-up",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["I've become smitten with this stacked bar chart alternative, as ",(0,r.jsx)(n.a,{href:"https://www.flerlagetwins.com/2025/04/the-best-alternative-to-stacked-bar.html",children:"recently showcased on the Flerlage Twins blog"}),". This article is a brilliant insight into a collaborative process between ",(0,r.jsx)(n.a,{href:"https://www.linkedin.com/in/sebastine-amede/",children:"Sebastine Amede"}),", ",(0,r.jsx)(n.a,{href:"https://www.linkedin.com/in/darraghmurray/",children:"Darragh Murray"})," and ",(0,r.jsx)(n.a,{href:"https://www.linkedin.com/in/kevin-flerlage-20106a8",children:"Kevin"}),", with a further spotlight on folks who have inspired their final design. It's a really brilliant way of keeping the part-to-whole idea of a stacked bar chart, while also making the individual segments much easier to compare."]}),"\n",(0,r.jsx)(n.p,{children:"As always, when I see cool things (and because I enjoy using the tooling as well as developing it), I wonder how easy they might be to replicate in Power BI using Deneb. I thought it would be a fun exercise to try and replicate the example from the blog post using Vega-Lite. Fortunately, Vega-Lite has multiple encoding channels along each direction for Cartesian plots, which makes it a fairly straightforward process."}),"\n","\n",(0,r.jsx)(n.h2,{id:"finished-recipe",children:"Finished Recipe"}),"\n",(0,r.jsx)(n.p,{children:"This is how our final design will look:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"finished-recipe",src:t(62565).A+"",title:"An alternative to a stacked bar chart, first grouping the data by one dimension (Country) and then by another (Segment). Country has a bar representing the total sales, and Segment has a bar representing the total sales for each segment. The segments are then displayed as a separate bar chart within the bar for each country. Segment is color-coded and show in the legend. Each bar has labels showing the total sales represented by each mark. The consolidated bar representing country also has a label showing which country the mark is representing.",width:"657",height:"406"})}),"\n",(0,r.jsxs)(n.p,{children:["Although Deneb is a Power BI-specific tool, I'll produce the example using Vega-Lite natively, so we can visualize our progress on this post using embedded Vega-Lite visuals that you can open in the Vega Editor to further explore and/or remix. There may be some steps to make modifications if you have a preference for using Deneb-specific features like integrating your ",(0,r.jsx)(n.a,{href:"/docs/schemes",children:"Power BI theme"})," or ",(0,r.jsx)(n.a,{href:"/docs/formatting",children:"Power BI-specific number formatting"}),", but they should be fairly straightforward."]}),"\n",(0,r.jsxs)(n.p,{children:["For those who just want to get started with the finished product, there are assets available ",(0,r.jsx)(n.a,{href:"#wrapping-up",children:"at the bottom of this article"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"our-data",children:"Our Data"}),"\n",(0,r.jsxs)(n.p,{children:["I'm going to start with the simple financial data that ",(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/power-bi/create-reports/sample-financial-download",children:"you can download from MS Learn"}),". For this example, I'm adding the ",(0,r.jsx)(n.strong,{children:"Country"})," and ",(0,r.jsx)(n.strong,{children:"Segment"})," columns, and the ",(0,r.jsx)(n.strong,{children:"$ Sales"})," measure, so we have a lower-level granularity than we might normally have for a simple bar chart:"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Country"}),(0,r.jsx)(n.th,{children:"Segment"}),(0,r.jsx)(n.th,{children:"Sales"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Canada"}),(0,r.jsx)(n.td,{children:"Channel Partners"}),(0,r.jsx)(n.td,{children:"19752468"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Canada"}),(0,r.jsx)(n.td,{children:"Enterprise"}),(0,r.jsx)(n.td,{children:"144752736"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Canada"}),(0,r.jsx)(n.td,{children:"Government"}),(0,r.jsx)(n.td,{children:"428829833"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Canada"}),(0,r.jsx)(n.td,{children:"Midmarket"}),(0,r.jsx)(n.td,{children:"21616940"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Canada"}),(0,r.jsx)(n.td,{children:"Small Business"}),(0,r.jsx)(n.td,{children:"361203792"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"France"}),(0,r.jsx)(n.td,{children:"Channel Partners"}),(0,r.jsx)(n.td,{children:"15178124"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"France"}),(0,r.jsx)(n.td,{children:"Enterprise"}),(0,r.jsx)(n.td,{children:"150182723"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"France"}),(0,r.jsx)(n.td,{children:"Government"}),(0,r.jsx)(n.td,{children:"432792397"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"France"}),(0,r.jsx)(n.td,{children:"Midmarket"}),(0,r.jsx)(n.td,{children:"25395919"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"France"}),(0,r.jsx)(n.td,{children:"Small Business"}),(0,r.jsx)(n.td,{children:"274034856"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Germany"}),(0,r.jsx)(n.td,{children:"Channel Partners"}),(0,r.jsx)(n.td,{children:"9807620"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Germany"}),(0,r.jsx)(n.td,{children:"Enterprise"}),(0,r.jsx)(n.td,{children:"146362549"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Germany"}),(0,r.jsx)(n.td,{children:"Government"}),(0,r.jsx)(n.td,{children:"307773485"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Germany"}),(0,r.jsx)(n.td,{children:"Midmarket"}),(0,r.jsx)(n.td,{children:"12452545"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Germany"}),(0,r.jsx)(n.td,{children:"Small Business"}),(0,r.jsx)(n.td,{children:"281729079"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Mexico"}),(0,r.jsx)(n.td,{children:"Channel Partners"}),(0,r.jsx)(n.td,{children:"8887825"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Mexico"}),(0,r.jsx)(n.td,{children:"Enterprise"}),(0,r.jsx)(n.td,{children:"130960356"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Mexico"}),(0,r.jsx)(n.td,{children:"Government"}),(0,r.jsx)(n.td,{children:"413892255"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Mexico"}),(0,r.jsx)(n.td,{children:"Midmarket"}),(0,r.jsx)(n.td,{children:"16428775"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Mexico"}),(0,r.jsx)(n.td,{children:"Small Business"}),(0,r.jsx)(n.td,{children:"308830851"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"United States of America"}),(0,r.jsx)(n.td,{children:"Channel Partners"}),(0,r.jsx)(n.td,{children:"12059458"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"United States of America"}),(0,r.jsx)(n.td,{children:"Enterprise"}),(0,r.jsx)(n.td,{children:"166894624"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"United States of America"}),(0,r.jsx)(n.td,{children:"Government"}),(0,r.jsx)(n.td,{children:"362146299"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"United States of America"}),(0,r.jsx)(n.td,{children:"Midmarket"}),(0,r.jsx)(n.td,{children:"21890524"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"United States of America"}),(0,r.jsx)(n.td,{children:"Small Business"}),(0,r.jsx)(n.td,{children:"463176030"})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["This produces the dataset for our Deneb visual and I'll add this to the ",(0,r.jsx)(n.strong,{children:"Values"})," data role, as I would for any project."]}),"\n",(0,r.jsx)(n.h2,{id:"thinking-about-our-design",children:"Thinking About Our Design"}),"\n",(0,r.jsxs)(n.p,{children:["While the finished recipe contains ",(0,r.jsx)(n.code,{children:"text"})," marks to further annotate our chart, the solution itself can be approached at a high level as follows:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Adding our highest-level grouping field (Country) to the ",(0,r.jsx)(n.code,{children:"x"})," encoding channel and aggregating our measure (Sales) using ",(0,r.jsx)(n.code,{children:"sum"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Adding our lower-level grouping field (Segment) to the ",(0,r.jsx)(n.code,{children:"xOffset"})," encoding channel."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Everything else will work within these constraints."}),"\n",(0,r.jsx)(n.h2,{id:"step-1-highest-level-grouping",children:"Step 1: Highest Level Grouping"}),"\n",(0,r.jsx)(n.p,{children:"Here's how we produce a summarized bar chart for our highest-level grouping (Country):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "data": { "name": "dataset" },\n  "layer": [\n    {\n      "encoding": { "y": { "field": "Sales", "aggregate": "sum" } },\n      "mark": { "type": "bar", "color": "#d4d4d4" }\n    }\n  ],\n  "encoding": {\n    "x": {\n      "field": "Country",\n      "sort": { "field": "Sales", "op": "sum", "order": "descending" }\n    },\n    "y": { "type": "quantitative" }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Note that I'm already thinking about the above approach by using a ",(0,r.jsx)(n.code,{children:"layer"})," rather than a ",(0,r.jsx)(n.code,{children:"mark"})," at the top level.."]}),"\n",(0,r.jsxs)(n.li,{children:["As our ",(0,r.jsx)(n.code,{children:"y"})," encoding channel is ",(0,r.jsx)(n.code,{children:"quantitative"}),", I'm putting that at the top level, and adding a ",(0,r.jsx)(n.code,{children:"y"})," encoding channel by an aggregate of ",(0,r.jsx)(n.strong,{children:"Sales"})," in the layer (due to granularity). This will inherit the top-level ",(0,r.jsx)(n.code,{children:"type"})," and we won't need to repeat this, due to how Vega-Lite will union the y-scale."]}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"x"})," encoding channel will be shared by all layers, so this is at the top level. I'm also sorting this in descending order of ",(0,r.jsx)(n.strong,{children:"Sales"})," (again aggregated)."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Our design looks pretty normal right now, but as we might expect:"}),"\n",(0,r.jsx)(i.A,{spec:{$schema:"https://vega.github.io/schema/vega-lite/v6.json",datasets:{dataset:[{Country:"Canada",Segment:"Channel Partners",Sales:19752468},{Country:"Canada",Segment:"Enterprise",Sales:144752736},{Country:"Canada",Segment:"Government",Sales:428829833},{Country:"Canada",Segment:"Midmarket",Sales:21616940},{Country:"Canada",Segment:"Small Business",Sales:361203792},{Country:"France",Segment:"Channel Partners",Sales:15178124},{Country:"France",Segment:"Enterprise",Sales:150182723},{Country:"France",Segment:"Government",Sales:432792397},{Country:"France",Segment:"Midmarket",Sales:25395919},{Country:"France",Segment:"Small Business",Sales:274034856},{Country:"Germany",Segment:"Channel Partners",Sales:9807620},{Country:"Germany",Segment:"Enterprise",Sales:146362549},{Country:"Germany",Segment:"Government",Sales:307773485},{Country:"Germany",Segment:"Midmarket",Sales:12452545},{Country:"Germany",Segment:"Small Business",Sales:281729079},{Country:"Mexico",Segment:"Channel Partners",Sales:8887825},{Country:"Mexico",Segment:"Enterprise",Sales:130960356},{Country:"Mexico",Segment:"Government",Sales:413892255},{Country:"Mexico",Segment:"Midmarket",Sales:16428775},{Country:"Mexico",Segment:"Small Business",Sales:308830851},{Country:"United States of America",Segment:"Channel Partners",Sales:12059458},{Country:"United States of America",Segment:"Enterprise",Sales:166894624},{Country:"United States of America",Segment:"Government",Sales:362146299},{Country:"United States of America",Segment:"Midmarket",Sales:21890524},{Country:"United States of America",Segment:"Small Business",Sales:463176030}]},width:580,height:360,data:{name:"dataset"},layer:[{encoding:{y:{field:"Sales",aggregate:"sum"}},mark:{type:"bar",color:"#d4d4d4"}}],encoding:{x:{field:"Country",sort:{field:"Sales",op:"sum",order:"descending"}},y:{type:"quantitative"}}}}),"\n",(0,r.jsx)(n.h2,{id:"step-2-lowest-level-grouping",children:"Step 2: Lowest Level Grouping"}),"\n",(0,r.jsxs)(n.p,{children:["With our primary channels (",(0,r.jsx)(n.code,{children:"x"})," and ",(0,r.jsx)(n.code,{children:"y"}),") worked out, we can add our second layer, which will perform the offset within each bar, based on the ",(0,r.jsx)(n.strong,{children:"Segment"})," field:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "data": { "name": "dataset" },\n  "layer": [\n    ... // Our first layer\n    {\n      "encoding": {\n        "y": { "field": "Sales" },\n        "xOffset": {\n          "field": "Segment",\n          "sort": { "field": "Sales", "order": "descending" },\n          "scale": { "padding": 0.2 }\n        },\n        "color": {\n          "field": "Segment",\n          "sort": {"field": "Sales", "order": "descending" }\n        }\n      },\n      "mark": { "type": "bar", "stroke": "white" }\n    }\n  ],\n  "encoding": {\n    ... // Our original encoding\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["This layer has the ",(0,r.jsx)(n.code,{children:"y"})," encoding channel set the the ",(0,r.jsx)(n.strong,{children:"Sales"})," field."]}),"\n",(0,r.jsx)(n.li,{children:"Because we're at our lowest level of granularity, we don't need to aggregate this."}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"xOffset"})," channel is set to the ",(0,r.jsx)(n.strong,{children:"Segment"})," field, and we're sorting this in descending order of ",(0,r.jsx)(n.strong,{children:"Sales"}),". This will produce individual bars within each bigger bar, sharing the top-level ",(0,r.jsx)(n.code,{children:"x"})," encoding channel for their corresponding ",(0,r.jsx)(n.strong,{children:"Country"}),". Theres a small amount of ",(0,r.jsx)(n.code,{children:"padding"})," here, to help space them out a bit better."]}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"color"})," channel is set to the ",(0,r.jsx)(n.strong,{children:"Segment"})," field, which will also give us our legend. This is sorted in descending order of sales, to match the ordering of the ",(0,r.jsx)(n.code,{children:"xOffset"})," channel and having each legend item match the order of the segments in the chart."]}),"\n",(0,r.jsxs)(n.li,{children:["Each bar has a white ",(0,r.jsx)(n.code,{children:"stroke"}),", just to help with contrast against the bar behind it."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:'As this point, we should be able to see that the main challenge has been solved and we have our "bars within bars" design:'}),"\n",(0,r.jsx)(i.A,{spec:{$schema:"https://vega.github.io/schema/vega-lite/v6.json",datasets:{dataset:[{Country:"Canada",Segment:"Channel Partners",Sales:19752468},{Country:"Canada",Segment:"Enterprise",Sales:144752736},{Country:"Canada",Segment:"Government",Sales:428829833},{Country:"Canada",Segment:"Midmarket",Sales:21616940},{Country:"Canada",Segment:"Small Business",Sales:361203792},{Country:"France",Segment:"Channel Partners",Sales:15178124},{Country:"France",Segment:"Enterprise",Sales:150182723},{Country:"France",Segment:"Government",Sales:432792397},{Country:"France",Segment:"Midmarket",Sales:25395919},{Country:"France",Segment:"Small Business",Sales:274034856},{Country:"Germany",Segment:"Channel Partners",Sales:9807620},{Country:"Germany",Segment:"Enterprise",Sales:146362549},{Country:"Germany",Segment:"Government",Sales:307773485},{Country:"Germany",Segment:"Midmarket",Sales:12452545},{Country:"Germany",Segment:"Small Business",Sales:281729079},{Country:"Mexico",Segment:"Channel Partners",Sales:8887825},{Country:"Mexico",Segment:"Enterprise",Sales:130960356},{Country:"Mexico",Segment:"Government",Sales:413892255},{Country:"Mexico",Segment:"Midmarket",Sales:16428775},{Country:"Mexico",Segment:"Small Business",Sales:308830851},{Country:"United States of America",Segment:"Channel Partners",Sales:12059458},{Country:"United States of America",Segment:"Enterprise",Sales:166894624},{Country:"United States of America",Segment:"Government",Sales:362146299},{Country:"United States of America",Segment:"Midmarket",Sales:21890524},{Country:"United States of America",Segment:"Small Business",Sales:463176030}]},width:580,height:360,data:{name:"dataset"},layer:[{encoding:{y:{field:"Sales",aggregate:"sum"}},mark:{type:"bar",color:"#d4d4d4"}},{encoding:{y:{field:"Sales"},xOffset:{field:"Segment",sort:{field:"Sales",order:"descending"},scale:{padding:.2}},color:{field:"Segment",sort:{field:"Sales",order:"descending"}}},mark:{type:"bar",stroke:"white"}}],encoding:{x:{field:"Country",sort:{field:"Sales",op:"sum",order:"descending"}},y:{type:"quantitative"}}}}),"\n",(0,r.jsx)(n.h2,{id:"step-3-cleaning-up-the-plot-area",children:"Step 3: Cleaning Up the Plot Area"}),"\n",(0,r.jsx)(n.p,{children:"For a more clutter-free design, we will need to remove the redundant elements from our chart. We will add labels in step 4, but this will help us to understand how much space we have to work with."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",metastring:"highlight={2-3,21,31,33}",children:'{\n  "title": { "text": "Country Revenue by Segment ($M)", "anchor": "start" },\n  "view": { "stroke": "transparent" },\n  "data": { "name": "dataset" },\n  "layer": [\n    {\n      "encoding": { "y": { "field": "Sales", "aggregate": "sum" } },\n      "mark": { "type": "bar", "color": "#d4d4d4" }\n    },\n    {\n      "encoding": {\n        "y": { "field": "Sales" },\n        "xOffset": {\n          "field": "Segment",\n          "sort": { "field": "Sales", "order": "descending" },\n          "scale": { "padding": 0.2 }\n        },\n        "color": {\n          "field": "Segment",\n          "sort": { "field": "Sales", "order": "descending" },\n          "legend": { "orient": "top", "title": null }\n        }\n      },\n      "mark": { "type": "bar", "stroke": "white" }\n    }\n  ],\n  "encoding": {\n    "x": {\n      "field": "Country",\n      "sort": { "field": "Sales", "op": "sum", "order": "descending" },\n      "axis": null\n    },\n    "y": { "type": "quantitative", "axis": null }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"The changes have been highlighted in the code above but can be summarized as:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Adding a title and anchoring it to the left (start)."}),"\n",(0,r.jsxs)(n.li,{children:["Setting the ",(0,r.jsx)(n.code,{children:"view"})," to have a transparent stroke, so we don't have a border around the plot area."]}),"\n",(0,r.jsxs)(n.li,{children:["Setting the ",(0,r.jsx)(n.code,{children:"legend"})," for the ",(0,r.jsx)(n.strong,{children:"Segment"})," field to be at the top, and removing the title (as it is redundant)."]}),"\n",(0,r.jsxs)(n.li,{children:["Removing both axes (setting them to ",(0,r.jsx)(n.code,{children:"null"}),"), as they are not needed."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Here is our refined design:"}),"\n",(0,r.jsx)(i.A,{spec:{$schema:"https://vega.github.io/schema/vega-lite/v6.json",datasets:{dataset:[{Country:"Canada",Segment:"Channel Partners",Sales:19752468},{Country:"Canada",Segment:"Enterprise",Sales:144752736},{Country:"Canada",Segment:"Government",Sales:428829833},{Country:"Canada",Segment:"Midmarket",Sales:21616940},{Country:"Canada",Segment:"Small Business",Sales:361203792},{Country:"France",Segment:"Channel Partners",Sales:15178124},{Country:"France",Segment:"Enterprise",Sales:150182723},{Country:"France",Segment:"Government",Sales:432792397},{Country:"France",Segment:"Midmarket",Sales:25395919},{Country:"France",Segment:"Small Business",Sales:274034856},{Country:"Germany",Segment:"Channel Partners",Sales:9807620},{Country:"Germany",Segment:"Enterprise",Sales:146362549},{Country:"Germany",Segment:"Government",Sales:307773485},{Country:"Germany",Segment:"Midmarket",Sales:12452545},{Country:"Germany",Segment:"Small Business",Sales:281729079},{Country:"Mexico",Segment:"Channel Partners",Sales:8887825},{Country:"Mexico",Segment:"Enterprise",Sales:130960356},{Country:"Mexico",Segment:"Government",Sales:413892255},{Country:"Mexico",Segment:"Midmarket",Sales:16428775},{Country:"Mexico",Segment:"Small Business",Sales:308830851},{Country:"United States of America",Segment:"Channel Partners",Sales:12059458},{Country:"United States of America",Segment:"Enterprise",Sales:166894624},{Country:"United States of America",Segment:"Government",Sales:362146299},{Country:"United States of America",Segment:"Midmarket",Sales:21890524},{Country:"United States of America",Segment:"Small Business",Sales:463176030}]},width:580,height:360,title:{text:"Country Revenue by Segment ($M)",anchor:"start"},view:{stroke:"transparent"},data:{name:"dataset"},layer:[{encoding:{y:{field:"Sales",aggregate:"sum"}},mark:{type:"bar",color:"#d4d4d4"}},{encoding:{y:{field:"Sales"},xOffset:{field:"Segment",sort:{field:"Sales",order:"descending"},scale:{padding:.2}},color:{field:"Segment",sort:{field:"Sales",order:"descending"},legend:{orient:"top"}}},mark:{type:"bar",stroke:"white"}}],encoding:{x:{field:"Country",sort:{field:"Sales",op:"sum",order:"descending"},axis:null},y:{type:"quantitative",axis:null}}}}),"\n",(0,r.jsx)(n.h2,{id:"step-4-labels",children:"Step 4: Labels"}),"\n",(0,r.jsxs)(n.p,{children:["For the last part of this walkthrough, I'm going to add labels for each bar using ",(0,r.jsx)(n.code,{children:"text"})," marks. As our two-layer approach works well, we can use descendant layers so that these marks inherit what they need from the existing layout:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",metastring:"highlight={5,9-21,32-47}",children:'{\n  "title": { "text": "Country Revenue by Segment ($M)", "anchor": "start" },\n  "view": { "stroke": "transparent" },\n  "data": { "name": "dataset" },\n  "transform": [{ "calculate": "datum.Sales / 1000000", "as": "Sales_M" }],\n  "layer": [\n    {\n      "encoding": { "y": { "field": "Sales", "aggregate": "sum" } },\n      "layer": [\n        { "mark": { "type": "bar", "color": "#d4d4d4" } },\n        {\n          "mark": { "type": "text", "baseline": "bottom", "dy": -15 },\n          "encoding": { "text": { "field": "Country" } }\n        },\n        {\n          "mark": { "type": "text", "baseline": "top", "dy": -15 },\n          "encoding": {\n            "text": { "field": "Sales_M", "aggregate": "sum", "format": ",d" }\n          }\n        }\n      ]\n    },\n    {\n      "encoding": {\n        "y": { "field": "Sales" },\n        "xOffset": {\n          "field": "Segment",\n          "sort": { "field": "Sales", "order": "descending" },\n          "scale": { "padding": 0.2 }\n        }\n      },\n      "layer": [\n        {\n          "mark": { "type": "bar", "stroke": "white" },\n          "encoding": {\n            "color": {\n              "field": "Segment",\n              "sort": { "field": "Sales", "order": "descending" },\n              "legend": { "orient": "top", "title": null }\n            }\n          }\n        },\n        {\n          "mark": { "type": "text", "dy": -7.5 },\n          "encoding": { "text": { "field": "Sales_M", "format": ",d" } }\n        }\n      ]\n    }\n  ],\n  "encoding": {\n    "x": {\n      "field": "Country",\n      "sort": { "field": "Sales", "op": "sum", "order": "descending" },\n      "axis": null\n    },\n    "y": { "type": "quantitative", "axis": null }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"I've again highlighted the lines that have changed, but an overview of what I've done is as follows:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Added a ",(0,r.jsx)(n.code,{children:"transform"})," to calculate the ",(0,r.jsx)(n.strong,{children:"Sales"})," measure in millions, and store it in a new field called ",(0,r.jsx)(n.strong,{children:"Sales_M"}),". This is used for the labels. We could do this using Power BI formatting against the ",(0,r.jsx)(n.strong,{children:"Sales"})," measure, but I'm trying to keep things replicable in Vega-Lite outside Power BI for this example."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Created a sub-layer in the first layer, for three marks:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Our original ",(0,r.jsx)(n.code,{children:"bar"})," mark, which is the grey bar for the ",(0,r.jsx)(n.strong,{children:"Country"})," field."]}),"\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.code,{children:"text"})," mark for the ",(0,r.jsx)(n.strong,{children:"Country"})," field, offset by ",(0,r.jsx)(n.code,{children:"dy"})," by -15 pixels (upwards)."]}),"\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.code,{children:"text"})," mark for the (aggregated) ",(0,r.jsx)(n.strong,{children:"Sales_M"})," field, offset by ",(0,r.jsx)(n.code,{children:"dy"})," -by 15 pixels (upwards)."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Both ",(0,r.jsx)(n.code,{children:"text"})," marks have opposing ",(0,r.jsx)(n.code,{children:"baseline"})," properties, so while they share the same ",(0,r.jsx)(n.code,{children:"y"})," position and ",(0,r.jsx)(n.code,{children:"offset"}),", they will be positioned above and below their resolved y-position accordingly."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"The second layer has a similar approach to the first, where we create a sub-layer for two marks:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"bar"})," mark, which is the colored bar for the ",(0,r.jsx)(n.strong,{children:"Segment"})," field. We have also moved the ",(0,r.jsx)(n.code,{children:"color"})," encoding for the layer into this sub-layer, so that the ",(0,r.jsx)(n.code,{children:"text"})," marks do not inherit it."]}),"\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.code,{children:"text"})," mark for the ",(0,r.jsx)(n.strong,{children:"Sales_M"})," field, offset by ",(0,r.jsx)(n.code,{children:"dy"})," by -7.5 pixels (upwards)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"And now we have a visual that looks like what we intended:"}),"\n",(0,r.jsx)(i.A,{spec:{$schema:"https://vega.github.io/schema/vega-lite/v6.json",datasets:{dataset:[{Country:"Canada",Segment:"Channel Partners",Sales:19752468},{Country:"Canada",Segment:"Enterprise",Sales:144752736},{Country:"Canada",Segment:"Government",Sales:428829833},{Country:"Canada",Segment:"Midmarket",Sales:21616940},{Country:"Canada",Segment:"Small Business",Sales:361203792},{Country:"France",Segment:"Channel Partners",Sales:15178124},{Country:"France",Segment:"Enterprise",Sales:150182723},{Country:"France",Segment:"Government",Sales:432792397},{Country:"France",Segment:"Midmarket",Sales:25395919},{Country:"France",Segment:"Small Business",Sales:274034856},{Country:"Germany",Segment:"Channel Partners",Sales:9807620},{Country:"Germany",Segment:"Enterprise",Sales:146362549},{Country:"Germany",Segment:"Government",Sales:307773485},{Country:"Germany",Segment:"Midmarket",Sales:12452545},{Country:"Germany",Segment:"Small Business",Sales:281729079},{Country:"Mexico",Segment:"Channel Partners",Sales:8887825},{Country:"Mexico",Segment:"Enterprise",Sales:130960356},{Country:"Mexico",Segment:"Government",Sales:413892255},{Country:"Mexico",Segment:"Midmarket",Sales:16428775},{Country:"Mexico",Segment:"Small Business",Sales:308830851},{Country:"United States of America",Segment:"Channel Partners",Sales:12059458},{Country:"United States of America",Segment:"Enterprise",Sales:166894624},{Country:"United States of America",Segment:"Government",Sales:362146299},{Country:"United States of America",Segment:"Midmarket",Sales:21890524},{Country:"United States of America",Segment:"Small Business",Sales:463176030}]},width:580,height:360,title:{text:"Country Revenue by Segment ($M)",anchor:"start"},view:{stroke:"transparent"},data:{name:"dataset"},transform:[{calculate:"datum.Sales / 1000000",as:"Sales_M"}],layer:[{encoding:{y:{field:"Sales",aggregate:"sum"}},layer:[{mark:{type:"bar",color:"#d4d4d4"}},{mark:{type:"text",baseline:"bottom",dy:-15},encoding:{text:{field:"Country"}}},{mark:{type:"text",baseline:"top",dy:-15},encoding:{text:{field:"Sales_M",aggregate:"sum",format:",d"}}}]},{encoding:{y:{field:"Sales"},xOffset:{field:"Segment",sort:{field:"Sales",order:"descending"},scale:{padding:.2}}},layer:[{mark:{type:"bar",stroke:"white"},encoding:{color:{field:"Segment",sort:{field:"Sales",order:"descending"},legend:{orient:"top",title:null}}}},{mark:{type:"text",dy:-7.5},encoding:{text:{field:"Sales_M",format:",d"}}}]}],encoding:{x:{field:"Country",sort:{field:"Sales",op:"sum",order:"descending"},axis:null},y:{type:"quantitative",axis:null}}}}),"\n",(0,r.jsx)(n.h2,{id:"wrapping-up",children:"Wrapping Up"}),"\n",(0,r.jsx)(n.p,{children:"I'm really grateful for Sebastine, Darragh and Kevin for taking the time to write up such a wonderful study on this approach and sharing their techniques with the data visualization community, and I hope that this implementation does that some justice, and help folks to implement this design in other tools. Hopefully anyone reading may have learned a little bit more about what Vega-Lite can do (and how Deneb can help you to achieve similar results in Power BI)."}),"\n",(0,r.jsx)(n.p,{children:"As promised, here are some links to the finished recipe:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(80710).A+"",children:"Power BI workbook (with visual)"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(11389).A+"",children:"Deneb template"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://vega.github.io/editor/#/url/vega-lite/N4IgJAzgxgFgpgWwIYgFwhgF0wBwqgegIDc4BzJAOjIEtMYBXAI0poHsDp5kTykBaADZ04JAGyUAVhDYA7EABoQAEySYkEOJghpQq9ZsxoA2qADCbBrMwAnAJ5oQZpLKSrFIAMrkEca47MYF1k4QQACAAUkG0wQmx0lTyRBOB1UAEYATgB2AFYAJgAWMQAOAF8Fc0trewCXNxREnz8jdABRazgbHBsaTQ8klLT0wsK8-OyAZjEKqqtbB3RnV3cmsl9-dABxNlIbWQ2jROTUtEL8kpL8zJLJydmnaoW6lcavZs2QAFkaZWQbADWWgGJzS+XSYghmUKAAYHhZ5rUlvVVu91i1HJ5kIJwgAhBgQGghCAJLygtDTdL5GGTbKZfLwp5IkAAMRsLigcAGH1aTiCshC4SiMTipMGpwyuXS2RKVMKjMRi1Z7NknO56M+HUwXR6fS5xyGaHSuRh6Su2Xy90qj0VjjZHP1aMOjh2ewOGINEsKkwm9MmOQVNSV9tVju8Gt5Pz+0SBRzJhtQ+Vy-tymSygee6BDarWzvQWOSeIJRNSYvJieysMmhRKuRm1oRQZdXWQsgcuYxS35gsi0ViXTLCZuMOyYmpGeZWxbLnbTs7IC1Ot6-U9w2K0yThUyE6VU5srdn4bzIFdXXd-lXFJH2SmNdyO+b+5n6uPUf+sZBCblBVyhXvDaZXdpzbF95wLHEwnxQliUHCULmla4R23ADbXQL44AADxoKA2FAz5AmCUJexFAdPwlS4ShlJMHzQzDsNwjtNU6bplzDct0kmGFMjEGk6xo746JwvDeVPfZnUvVBCg4kp6STf85ibWisKExjI1+d9gQkiFzkovJ+PQ5SGLnT5wKLaDSzItJOMuaypX4gBVWQRGUMJPHUbUIDCNgADMwgAQV8XooDeI95wIgUiOFft4kso1qVTP9yhQxSQEc5zXPc1IvN8gKumwkKeUcRcWL1WKMjEUpoTHeVkszVKnO1Fy3LULKfP8wL8uEl1djPcT4wlDcRjHTJkIUuq0sajKWs8trcqCgqI0cN8Y00-qwTNTIYQKGqxuZCa4CazKZpyjrgq6-NsTMksSTK9dpR4ziygAXQqEAAHdfnoNBchKGElHgGgyCwCkeKUTA6BSXQQG1DDeUbBYwgAJTgUhZAYOAwiYOxXJ5MIAAowC+ABKDwORgNgbEcCB1BiEBXuIGg4DeqHqZsNggUcWwXAgHBogxV79BQVBQFcXxHEFww6bBlUIG8imEBMUBgsEKAGEEFrxbUBgEEocVPIIMJ0hhY2TdJtI1oAfS+OmnqUdW7C6RWQD8HDlCJMgocWUBvMZwRlExcklCQMgyBsPhtSp7W6de+3HdQUwQHfKHMDsHAuXQJhog8HDBApxwAGJlEKIui+j60k+F6HU-T6HMLjTPNGEEJHCYNhsDYBWlGURZ+GNV6XbYN3ZA9yuYdab3ff9pZAOjh4K9AFO085uuPAb0IS05tgcA8bu0F7-9ndVQf3eTlfK590Ip8t62g5DsOKAj9AICjpQ5afXkFH9spv5e60B6HkeoAvYgAvn7AOhpXoYQAPLeW8pLc+k9MSFSUDIWmCDL7gNOEoCmyg44qFSJyWQACpYgGgCcKGvNlDENQDCSgDJv52yQA7Sm8dQDzyrkvDOWcUG2HZjXN6MARAkP-ifSuOc87oLAfmZBpCKbjxAYg-MgcQA4Lwbg6AfhiEx3IJoqGFNGafEwFvDw4NMCQ1QGjHE38GFsJjMnauy9YY7x7tkSgB8RHD1Pk4yRV89ZWw8G-ZAH8v4-2ekoDxgCQAYShqAq+8NagoLkTExRa0PDGKfi-FRNhcEsPwRoohJ9XpICwmkSxghXrAMXjXAAjgwFwpi1A0FIKTEpaAynWKAA",children:"Version in Vega Editor"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Thanks as always for reading!"}),"\n",(0,r.jsx)(n.p,{children:"DM-P"})]})}function g(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},62565:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/finished-recipe-84c7c39f6feed2f56a3e6f53db9d7d06.png"},80710:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/files/Deneb - Stacked Bar Alternative-ce64280ee628fe47b276c1e000e02514.pbix"}}]);