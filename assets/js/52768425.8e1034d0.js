"use strict";(self.webpackChunkdeneb_doc=self.webpackChunkdeneb_doc||[]).push([[7951],{78077:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>a,contentTitle:()=>l,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var t=n(85893),s=n(11151);const r={id:"selection-advanced",slug:"/interactivity-selection-advanced",sidebar_label:"Advanced Cross-Filtering"},l="Advanced Cross-Filtering",o={id:"interactivity/selection-advanced",title:"Advanced Cross-Filtering",description:"For many use cases, Deneb's cross-filtering is typically enough. However, there are people who want much more control over how cross-filtering should work within their designs, and the advanced cross-filtering features are designed to help with this.",source:"@site/docs/interactivity/selection-advanced.md",sourceDirName:"interactivity",slug:"/interactivity-selection-advanced",permalink:"/next/interactivity-selection-advanced",draft:!1,unlisted:!1,editUrl:"https://github.com/deneb-viz/deneb-viz.github.io/edit/source/docs/interactivity/selection-advanced.md",tags:[],version:"current",frontMatter:{id:"selection-advanced",slug:"/interactivity-selection-advanced",sidebar_label:"Advanced Cross-Filtering"},sidebar:"mainSidebar",previous:{title:"Cross-Filtering (Selection)",permalink:"/next/interactivity-selection"},next:{title:"Cross-Highlighting",permalink:"/next/interactivity-highlight"}},a={},c=[{value:"How Advanced Cross-Filtering Works (in a Nutshell)",id:"how-advanced-cross-filtering-works-in-a-nutshell",level:2},{value:"Enabling Advanced Cross-Filtering",id:"enabling-advanced-cross-filtering",level:2},{value:"Approach for Advanced Management Within your Specification",id:"approach-for-advanced-management-within-your-specification",level:2},{value:"Expression Functions in Detail",id:"expression-functions-in-detail",level:2},{value:"<code>pbiCrossFilterClear()</code>",id:"pbicrossfilterclear",level:3},{value:"Function Implementation",id:"function-implementation",level:4},{value:"<code>pbiCrossFilterApply()</code>",id:"pbicrossfilterapply",level:3},{value:"Function Implementation",id:"function-implementation-1",level:4}];function h(e){const i={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.h1,{id:"advanced-cross-filtering",children:"Advanced Cross-Filtering"}),"\n",(0,t.jsxs)(i.p,{children:["For many use cases, Deneb's ",(0,t.jsx)(i.a,{href:"interactivity-selection",children:"cross-filtering"})," is typically enough. However, there are people who want much more control over how cross-filtering should work within their designs, and the advanced cross-filtering features are designed to help with this."]}),"\n",(0,t.jsx)(i.admonition,{title:"This mode is only available for developers using Vega",type:"info",children:(0,t.jsxs)(i.p,{children:["If you are using Vega-Lite, or are happy with how your cross-filtering is managed with the ",(0,t.jsx)(i.em,{children:"Simple"})," mode, then it's probably best to skip through to the ",(0,t.jsx)(i.a,{href:"interactivity-highlight",children:"next page"}),"."]})}),"\n",(0,t.jsx)(i.h2,{id:"how-advanced-cross-filtering-works-in-a-nutshell",children:"How Advanced Cross-Filtering Works (in a Nutshell)"}),"\n",(0,t.jsx)(i.p,{children:"Because your resulting visual specification might be quite different from your source dataset, it's not always easy to trace lineage of a mark back to its source data point (which is essentially what simple cross-filtering does). At a high level, you can do the following with the functionality provided:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Specify exactly when events are triggered through Vega."}),"\n",(0,t.jsx)(i.li,{children:"Rather than just use the current data point in the event, you can specify a filter to apply to the original dataset sent by Power BI, based on this data point (or even static logic)."}),"\n",(0,t.jsxs)(i.li,{children:["Whatever is returned by this filter will be subject to cross-filtering (with all eligible data points having their ",(0,t.jsx)(i.code,{children:"__selected__"})," field set accordingly)."]}),"\n",(0,t.jsxs)(i.li,{children:["The filter you construct is a valid Vega ",(0,t.jsx)(i.code,{children:"filter"})," transform."]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"There is a lot of scope in this functionality, which will open up how cross-filtering works and we couldn't possibly document (or know) what's possible. Instead this page will focus on providing you with as much detail about the functionality as we can so that you can use this as a basis for your own designs."}),"\n",(0,t.jsx)(i.h2,{id:"enabling-advanced-cross-filtering",children:"Enabling Advanced Cross-Filtering"}),"\n",(0,t.jsxs)(i.p,{children:["Vega allows you to control much more in terms of what happens with events inside a visual (known as ",(0,t.jsx)(i.a,{href:"https://vega.github.io/vega/docs/event-streams/",children:"Event Streams"}),"). These Event Streams allow you to set signal values using ",(0,t.jsx)(i.a,{href:"https://vega.github.io/vega/docs/expressions/",children:"Expressions"}),". As such, you are able to define all kinds of ways to define how a user can interact with your visual and this can create all kinds of interesting opportunities for how you can invoke cross-filtering from your visual to others on the page."]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["You can configure whether Deneb should attempt to ",(0,t.jsx)(i.a,{href:"#data-point-resolution",children:"resolve data points"})," when clicking on marks, through the ",(0,t.jsx)(i.strong,{children:"Expose cross-filtering values for dataset rows"})," property in the ",(0,t.jsx)(i.em,{children:"Vega > Power BI Interactivity"})," section of the ",(0,t.jsx)(i.a,{href:"visual-editor#settings-tab",children:"Settings pane in the Visual editor"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["This setting is ",(0,t.jsx)(i.strong,{children:"disabled"})," by default."]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["For each row in the visual ",(0,t.jsx)(i.code,{children:'"dataset"'}),", Deneb will generate a ",(0,t.jsx)(i.a,{href:"#the-__selected__-field",children:"special field for each row"})," called ",(0,t.jsx)(i.code,{children:'"__selected__"'}),", and will update this based on click events, or eligible external events to your visual, such as restoring a bookmark with an active selection state."]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["The ",(0,t.jsx)(i.em,{children:"Cross filtering management"})," mode should be set to ",(0,t.jsx)(i.strong,{children:"Advanced"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(i.admonition,{title:"Now you're on your own",type:"caution",children:(0,t.jsx)(i.p,{children:"With this setting enabled, Deneb will no longer monitor for click events, or clear the current-cross filter on your behalf."})}),"\n",(0,t.jsx)(i.h2,{id:"approach-for-advanced-management-within-your-specification",children:"Approach for Advanced Management Within your Specification"}),"\n",(0,t.jsx)(i.p,{children:"With the above in mind, you need to then think about what to do with the events that you wish to wire up to Vega, either:"}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["Clear the current cross-filter selection - this is carried out via the ",(0,t.jsx)(i.code,{children:"pbiCrossFilterClear"})," expression function."]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["Apply/update the current cross-filter selection - this is carried out via the ",(0,t.jsx)(i.code,{children:"pbiCrossFilterApply"})," expression function."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"Both functions are documented in detail further below so that you can get the most out of them, but we'll do a simple worked example that mimics the simple cross filtering, so that you can start to understand how to think about managing this yourself."}),"\n",(0,t.jsxs)(i.p,{children:["In this example, we have a mark that we've named ",(0,t.jsx)(i.code,{children:"data-point"}),", and we want to manage the cross-filter state via a signal we've named ",(0,t.jsx)(i.code,{children:"pbiCrossFilterSelection"}),":"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-json",children:'{\n  "marks": [\n    {\n      /* The mark we wish to monitor (and encode) */\n      "name": "data-point",\n      ...\n    }\n  ],\n  ...\n  "signals": [\n    {\n      "name": "pbiCrossFilterSelection",\n      "value": [],\n      "on": [\n        /* When specified mark is clicked, apply the cross-filter operation */\n        {\n          "events": {\n            "source": "scope",\n            "type": "mouseup",\n            "markname": "data-point"\n          },\n          "update": "pbiCrossFilterApply(event)"\n        },\n        /* When the view is clicked (but not our mark by name), clear the current cross-filter */\n        {\n          "events": {\n            "source": "view",\n            "type": "mouseup",\n            "filter": [\n              "!event.item || event.item.mark.name != \'data-point\'"\n            ]\n          },\n          "update": "pbiCrossFilterClear()"\n        }\n      ]\n    }\n  ],\n  ...\n}\n'})}),"\n",(0,t.jsx)(i.admonition,{title:"Handling 'catch-all' events against the view",type:"caution",children:(0,t.jsxs)(i.p,{children:["You'll notice that there is very specific filtering in the ",(0,t.jsx)(i.code,{children:"mouseup"})," event stream handler, so that the mark is excluded by its name. This is because monitoring the view for an event will include any marks as well. ",(0,t.jsx)(i.a,{href:"https://github.com/vega/vega/issues/1493",children:"Vega does not currently prevent propagation of the event from a mark to the view"}),", so for now you will need to bear this in mind when implementing 'catch-all' events against the view."]})}),"\n",(0,t.jsx)(i.p,{children:"Some other key takeaways at this stage:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["The ",(0,t.jsx)(i.code,{children:"pbiCrossFilterApply"})," event requires the ",(0,t.jsxs)(i.a,{href:"https://vega.github.io/vega/docs/expressions/#event",children:["bound ",(0,t.jsx)(i.code,{children:"event"})," variable"]})," as its first parameter. This contains the information about the event type being captured and the backing datum for the mark or element being interacted with."]}),"\n",(0,t.jsxs)(i.li,{children:["With no further parameters, the ",(0,t.jsx)(i.code,{children:"pbiCrossFilterApply"})," method will just work against the current datum (if it exists) and will mimic simple cross-filtering (including multi-selection handling via Ctrl/Shift key state)."]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"expression-functions-in-detail",children:"Expression Functions in Detail"}),"\n",(0,t.jsx)(i.h3,{id:"pbicrossfilterclear",children:(0,t.jsx)(i.code,{children:"pbiCrossFilterClear()"})}),"\n",(0,t.jsx)(i.p,{children:"This expression function explicitly instructs the Power BI host to clear the active data points subject to cross-filtering."}),"\n",(0,t.jsx)(i.h4,{id:"function-implementation",children:"Function Implementation"}),"\n",(0,t.jsx)(i.p,{children:"As it is an explicit operation, no further parameters are needed."}),"\n",(0,t.jsx)(i.h3,{id:"pbicrossfilterapply",children:(0,t.jsx)(i.code,{children:"pbiCrossFilterApply()"})}),"\n",(0,t.jsx)(i.p,{children:"This expression function is used to apply a cross-filter selection to the Power BI host."}),"\n",(0,t.jsx)(i.h4,{id:"function-implementation-1",children:"Function Implementation"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-ts",children:"pbiCrossFilterApply ( event, filter? options? )\n"})}),"\n",(0,t.jsx)(i.p,{children:"Where:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.code,{children:"event"})," is the ",(0,t.jsxs)(i.a,{href:"https://vega.github.io/vega/docs/expressions/#event",children:["bound ",(0,t.jsx)(i.code,{children:"event"})," variable"]})," accessible to expression functions"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"This contains the information about the event type being captured and the backing datum for the mark or element being interacted with."}),"\n",(0,t.jsxs)(i.li,{children:["The ",(0,t.jsx)(i.code,{children:"event"})," contains the current ",(0,t.jsx)(i.code,{children:"datum"}),", if Vega can resolve it."]}),"\n",(0,t.jsxs)(i.li,{children:["If this is not a valid ",(0,t.jsx)(i.code,{children:"event"})," object, we will not apply cross-filtering, and a warning will be shown in the ",(0,t.jsx)(i.strong,{children:"Logs"})," pane."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.code,{children:"filter"})," is the optional (string) Vega filter expression to supply to the base visual dataset, and this is the objective you should aim for when thinking about how to construct your expression."]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["If this is not supplied or empty (",(0,t.jsx)(i.code,{children:"''"})," / ",(0,t.jsx)(i.code,{children:"undefined"})," / ",(0,t.jsx)(i.code,{children:"null"}),"), then Deneb will invoke simple filtering, i.e., resolve the data point from the ",(0,t.jsx)(i.code,{children:"event"})," parameter and do single-select."]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["Exceptions to this will result in the cross-filter not being applied and a warning being raised in the ",(0,t.jsx)(i.em,{children:"Logs"})," pane."]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["The filter must be a valid Vega ",(0,t.jsxs)(i.a,{href:"https://vega.github.io/vega/docs/transforms/filter/",children:[(0,t.jsx)(i.code,{children:"filter"})," transform"]})," syntax."]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["In the context of this string, ",(0,t.jsx)(i.code,{children:"datum.field"})," will apply to the desired field in the base dataset you want to apply your criteria to, as if you were applying a normal filter transform higher up in your spec."]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["To reference the ",(0,t.jsx)(i.code,{children:"datum"})," of the mark that is being interacted with, you can either:"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Manually add the resolved value using terminated/escaped values as a normal expression, or..."}),"\n",(0,t.jsx)(i.li,{children:"Add a placeholder expression, which Deneb will resolve for you (and save some effort having to work out the correctly escaped syntax yourself."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["The following filters are syntactically the same internally once the expression is evaluated by Deneb (assuming ",(0,t.jsx)(i.code,{children:"datum['Product']"})," of the current subject/mark is (",(0,t.jsx)(i.em,{children:"'Paseo'"}),"):\n\xa0"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-js",children:"// manually assembling\n\"pbiCrossFilterApply ( event, \\\"datum['Product'] == '\\\" + datum['Product'] + \\\"'\\\")\";\n\n// using the placeholder syntax\n\"pbiCrossFilterApply ( event, \\\"datum['Product'] == _{Product}_\\\" )\";\n\n// resolved filter expression\n\"datum['Product'] == 'Paseo'\";\n"})}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["For the placeholder expression the enclosing characters to denote this are ",(0,t.jsx)(i.code,{children:"_{"})," and ",(0,t.jsx)(i.code,{children:"}_"}),". Therefore, the parser will regard anything you include between them as the field name. This means that if you have fields containing special characters or whitespace, e.g. ",(0,t.jsx)(i.code,{children:"$ Sales"}),", you would enter this as ",(0,t.jsx)(i.code,{children:"_{$ Sales}_"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["If there are parse errors in this ",(0,t.jsx)(i.code,{children:"filter"})," parameter, we try to raise the appropriate errors or warnings in the ",(0,t.jsx)(i.em,{children:"Logs"})," pane to help you debug."]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsx)(i.p,{children:"Behind the scenes, Deneb creates a headless Vega spec containing only the base dataset, top-level signals and the resolved transform. This 'spec' is parsed, and the resulting rows are returned to the cross-filtering handler. These rows then become the subject of cross-filtering."}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["Because the ",(0,t.jsx)(i.code,{children:"filter"})," expression is a valid Vega transform, you can combine predicates to create more sophisticated filter targets."]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsx)(i.p,{children:"All current top-level signal values from your specification will be accessible when the filter is evaluated."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.code,{children:"options"})," is an optional object containing further control over behavior."]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsx)(i.p,{children:"If omitted, Deneb will use the defaults for supported properties (detailed in context below)."}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["If you wish to use this, but not filter (i.e. ",(0,t.jsx)(i.em,{children:"Simple"})," selection with specific modifiers), supply an empty property for ",(0,t.jsx)(i.code,{children:"filter"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsx)(i.p,{children:"Valid properties for this object are:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.code,{children:"limit"}),": the maximum number of data points to permit when cross-filtering."]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["This is the same as the ",(0,t.jsx)(i.a,{href:"https://deneb-viz.github.io/interactivity-selection#data-point-limit",children:(0,t.jsx)(i.em,{children:"Data point limit"})})," setting for ",(0,t.jsx)(i.em,{children:"Simple"})," selection."]}),"\n",(0,t.jsxs)(i.li,{children:["The same limits apply as this option for ",(0,t.jsx)(i.em,{children:"Simple"})," mode, i.e., ",(0,t.jsx)(i.strong,{children:"1"})," minimum, ",(0,t.jsx)(i.strong,{children:"2,500"})," maximum."]}),"\n",(0,t.jsx)(i.li,{children:"The maximum cap is for performance reasons, as it gets expensive for Power BI to resolve them. If, through experimentation, you find better sensible limits, we can increase this, but we do have to make sure that we don't cause the visual to crash, as this will be a blocker for certification."}),"\n",(0,t.jsxs)(i.li,{children:["If omitted, the default is ",(0,t.jsx)(i.strong,{children:"50"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.code,{children:"multiSelect"}),": an array of values specifying which keys apply to this operation."]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Valid values are ",(0,t.jsx)(i.code,{children:"ctrl"}),", ",(0,t.jsx)(i.code,{children:"shift"})," and ",(0,t.jsx)(i.code,{children:"alt"}),"."]}),"\n",(0,t.jsx)(i.li,{children:"Using multiple values will mean that either key being held down will apply to that event."}),"\n",(0,t.jsxs)(i.li,{children:["If omitted, the default is ",(0,t.jsx)(i.code,{children:"['ctrl', 'shift']"}),", which mimics typical Power BI visual multi-selection (either ctrl or shift is held down to specify multi-selection)."]}),"\n",(0,t.jsx)(i.li,{children:"The theory here is that you might be able to set up multiple interactions via different signals or key/mouse events, e.g., regular cross-filtering through clicking and something like using the alt key held down to invoke lasso selection (or, you might choose to use a drag event for this, but we want to give you as much flexibility as possible)."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]})]})}function d(e={}){const{wrapper:i}={...(0,s.a)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},11151:(e,i,n)=>{n.d(i,{Z:()=>o,a:()=>l});var t=n(67294);const s={},r=t.createContext(s);function l(e){const i=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function o(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),t.createElement(r.Provider,{value:i},e.children)}}}]);