<!doctype html><html lang=en dir=ltr class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.8.1"><title data-rh=true>How-To: The Stacked Bar Alternative | Deneb</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://deneb-viz.github.io/blog/stacked-bar-alternative><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docusaurus_tag content=default><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docsearch:docusaurus_tag content=default><meta data-rh=true property=og:title content="How-To: The Stacked Bar Alternative | Deneb"><meta data-rh=true name=description content="Using Vega-Lite to replicate a more readable alternative to a stacked bar chart."><meta data-rh=true property=og:description content="Using Vega-Lite to replicate a more readable alternative to a stacked bar chart."><meta data-rh=true property=og:image content=https://deneb-viz.github.io/img/blog/2025-04-08-stacked-bar/finished-recipe.png><meta data-rh=true name=twitter:image content=https://deneb-viz.github.io/img/blog/2025-04-08-stacked-bar/finished-recipe.png><meta data-rh=true property=og:type content=article><meta data-rh=true property=article:published_time content=2025-04-08T00:00:00.000Z><meta data-rh=true property=article:author content=https://github.com/dm-p><meta data-rh=true property=article:tag content=how-to,vega-lite><link data-rh=true rel=icon href=/img/favicon.png><link data-rh=true rel=canonical href=https://deneb-viz.github.io/blog/stacked-bar-alternative><link data-rh=true rel=alternate href=https://deneb-viz.github.io/blog/stacked-bar-alternative hreflang=en><link data-rh=true rel=alternate href=https://deneb-viz.github.io/blog/stacked-bar-alternative hreflang=x-default><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@id":"https://deneb-viz.github.io/blog/stacked-bar-alternative","@type":"BlogPosting","author":{"@type":"Person","description":"Program Manager & Developer","image":"https://github.com/dm-p.png","name":"Daniel Marsh-Patrick","url":"https://github.com/dm-p"},"datePublished":"2025-04-08T00:00:00.000Z","description":"Using Vega-Lite to replicate a more readable alternative to a stacked bar chart.","headline":"How-To: The Stacked Bar Alternative","image":{"@id":"https://deneb-viz.github.io/img/blog/2025-04-08-stacked-bar/finished-recipe.png","@type":"ImageObject","caption":"title image for the blog post: How-To: The Stacked Bar Alternative","contentUrl":"https://deneb-viz.github.io/img/blog/2025-04-08-stacked-bar/finished-recipe.png","url":"https://deneb-viz.github.io/img/blog/2025-04-08-stacked-bar/finished-recipe.png"},"isPartOf":{"@id":"https://deneb-viz.github.io/blog","@type":"Blog","name":"Blog"},"keywords":[],"mainEntityOfPage":"https://deneb-viz.github.io/blog/stacked-bar-alternative","name":"How-To: The Stacked Bar Alternative","url":"https://deneb-viz.github.io/blog/stacked-bar-alternative"}</script><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="Deneb RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="Deneb Atom Feed"><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=UA-143608567-3"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-143608567-3",{anonymize_ip:!0})</script><link rel=stylesheet href=/assets/css/styles.70d4f367.css><script src=/assets/js/runtime~main.f147685c.js defer></script><script src=/assets/js/main.6eb9d559.js defer></script><body class=navigation-with-keyboard><svg xmlns=http://www.w3.org/2000/svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light",e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/banner.png alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/img/banner_dark.png alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href=/docs>Docs</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/blog>Blog</a><a class="navbar__item navbar__link" href=/community/resources>Community & Resources</a><a class="navbar__item navbar__link" href=/support>Support</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class=navbar__link aria-haspopup=true aria-expanded=false role=button href=/docs>1.8</a><ul class=dropdown__menu><li><a class=dropdown__link href=/docs/next>Canary ðŸš§</a><li><a class=dropdown__link href=/docs>1.8</a><li><a class=dropdown__link href=/docs/1.7>1.7</a><li><a class=dropdown__link href=/docs/1.6>1.6</a><li><a class=dropdown__link href=/docs/1.5>1.5</a><li><a class=dropdown__link href=/docs/1.4>1.4</a><li><a class=dropdown__link href=/docs/1.3>1.3</a><li><a class=dropdown__link href=/docs/1.2>1.2</a><li><a class=dropdown__link href=/docs/1.1>1.1</a><li><a class=dropdown__link href=/docs/1.0>1.0</a></ul></div><a href=https://github.com/sponsors/deneb-viz target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">Sponsor<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><a class="navbar__item navbar__link" href=/privacy-policy>Privacy Policy</a><a href=https://github.com/deneb-viz/deneb target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_Bca1></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class=row><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role=group><h3 class=yearGroupHeading_rMGB>2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/1-8-release>Deneb 1.8 Released</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/sample-workbook-update>New AppSource Sample Workbook</a><li class=sidebarItem__DBe><a aria-current=page class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href=/blog/stacked-bar-alternative>How-To: The Stacked Bar Alternative</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2024-2025-summary>Deneb Annual Round-Up</a></ul></div><div role=group><h3 class=yearGroupHeading_rMGB>2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/1-7-2-submission>Deneb 1.7.2 Standalone Available (and submitted to AppSource)</a></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class=title_f1Hy>How-To: The Stacked Bar Alternative</h1><div class="container_mt6G margin-vert--md"><time datetime=2025-04-08T00:00:00.000Z>April 8, 2025</time> Â· <!-- -->15 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href=https://github.com/dm-p target=_blank rel="noopener noreferrer" class=avatar__photo-link><img class="avatar__photo authorImage_XqGP" src=https://github.com/dm-p.png alt="Daniel Marsh-Patrick"></a><div class="avatar__intro authorDetails_lV9A"><div class=avatar__name><a href=https://github.com/dm-p target=_blank rel="noopener noreferrer"><span class=authorName_yefp>Daniel Marsh-Patrick</span></a></div><small class=authorTitle_nd0D title="Program Manager & Developer">Program Manager & Developer</small><div class=authorSocials_rSDt></div></div></div></div></div></header><div id=__blog-post-container class=markdown><p>I've become smitten with this stacked bar chart alternative, as <a href=https://www.flerlagetwins.com/2025/04/the-best-alternative-to-stacked-bar.html target=_blank rel="noopener noreferrer">recently showcased on the Flerlage Twins blog</a>. This article is a brilliant insight into a collaborative process between <a href=https://www.linkedin.com/in/sebastine-amede/ target=_blank rel="noopener noreferrer">Sebastine Amede</a>, <a href=https://www.linkedin.com/in/darraghmurray/ target=_blank rel="noopener noreferrer">Darragh Murray</a> and <a href=https://www.linkedin.com/in/kevin-flerlage-20106a8 target=_blank rel="noopener noreferrer">Kevin</a>, with a further spotlight on folks who have inspired their final design. It's a really brilliant way of keeping the part-to-whole idea of a stacked bar chart, while also making the individual segments much easier to compare.</p>
<p>As always, when I see cool things (and because I enjoy using the tooling as well as developing it), I wonder how easy they might be to replicate in Power BI using Deneb. I thought it would be a fun exercise to try and replicate the example from the blog post using Vega-Lite. Fortunately, Vega-Lite has multiple encoding channels along each direction for Cartesian plots, which makes it a fairly straightforward process.</p>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=finished-recipe>Finished Recipe<a href=#finished-recipe class=hash-link aria-label="Direct link to Finished Recipe" title="Direct link to Finished Recipe">â€‹</a></h2>
<p>This is how our final design will look:</p>
<p><img decoding=async loading=lazy alt=finished-recipe src=/assets/images/finished-recipe-84c7c39f6feed2f56a3e6f53db9d7d06.png title="An alternative to a stacked bar chart, first grouping the data by one dimension (Country) and then by another (Segment). Country has a bar representing the total sales, and Segment has a bar representing the total sales for each segment. The segments are then displayed as a separate bar chart within the bar for each country. Segment is color-coded and show in the legend. Each bar has labels showing the total sales represented by each mark. The consolidated bar representing country also has a label showing which country the mark is representing." width=657 height=406 class=img_ev3q></p>
<p>Although Deneb is a Power BI-specific tool, I'll produce the example using Vega-Lite natively, so we can visualize our progress on this post using embedded Vega-Lite visuals that you can open in the Vega Editor to further explore and/or remix. There may be some steps to make modifications if you have a preference for using Deneb-specific features like integrating your <a href=/docs/schemes>Power BI theme</a> or <a href=/docs/formatting>Power BI-specific number formatting</a>, but they should be fairly straightforward.</p>
<p>For those who just want to get started with the finished product, there are assets available <a href=#wrapping-up>at the bottom of this article</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=our-data>Our Data<a href=#our-data class=hash-link aria-label="Direct link to Our Data" title="Direct link to Our Data">â€‹</a></h2>
<p>I'm going to start with the simple financial data that <a href=https://learn.microsoft.com/en-us/power-bi/create-reports/sample-financial-download target=_blank rel="noopener noreferrer">you can download from MS Learn</a>. For this example, I'm adding the <strong>Country</strong> and <strong>Segment</strong> columns, and the <strong>$ Sales</strong> measure, so we have a lower-level granularity than we might normally have for a simple bar chart:</p>
<table><thead><tr><th>Country<th>Segment<th>Sales<tbody><tr><td>Canada<td>Channel Partners<td>19752468<tr><td>Canada<td>Enterprise<td>144752736<tr><td>Canada<td>Government<td>428829833<tr><td>Canada<td>Midmarket<td>21616940<tr><td>Canada<td>Small Business<td>361203792<tr><td>France<td>Channel Partners<td>15178124<tr><td>France<td>Enterprise<td>150182723<tr><td>France<td>Government<td>432792397<tr><td>France<td>Midmarket<td>25395919<tr><td>France<td>Small Business<td>274034856<tr><td>Germany<td>Channel Partners<td>9807620<tr><td>Germany<td>Enterprise<td>146362549<tr><td>Germany<td>Government<td>307773485<tr><td>Germany<td>Midmarket<td>12452545<tr><td>Germany<td>Small Business<td>281729079<tr><td>Mexico<td>Channel Partners<td>8887825<tr><td>Mexico<td>Enterprise<td>130960356<tr><td>Mexico<td>Government<td>413892255<tr><td>Mexico<td>Midmarket<td>16428775<tr><td>Mexico<td>Small Business<td>308830851<tr><td>United States of America<td>Channel Partners<td>12059458<tr><td>United States of America<td>Enterprise<td>166894624<tr><td>United States of America<td>Government<td>362146299<tr><td>United States of America<td>Midmarket<td>21890524<tr><td>United States of America<td>Small Business<td>463176030</table>
<p>This produces the dataset for our Deneb visual and I'll add this to the <strong>Values</strong> data role, as I would for any project.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=thinking-about-our-design>Thinking About Our Design<a href=#thinking-about-our-design class=hash-link aria-label="Direct link to Thinking About Our Design" title="Direct link to Thinking About Our Design">â€‹</a></h2>
<p>While the finished recipe contains <code>text</code> marks to further annotate our chart, the solution itself can be approached at a high level as follows:</p>
<ol>
<li>Adding our highest-level grouping field (Country) to the <code>x</code> encoding channel and aggregating our measure (Sales) using <code>sum</code>.</li>
<li>Adding our lower-level grouping field (Segment) to the <code>xOffset</code> encoding channel.</li>
</ol>
<p>Everything else will work within these constraints.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=step-1-highest-level-grouping>Step 1: Highest Level Grouping<a href=#step-1-highest-level-grouping class=hash-link aria-label="Direct link to Step 1: Highest Level Grouping" title="Direct link to Step 1: Highest Level Grouping">â€‹</a></h2>
<p>Here's how we produce a summarized bar chart for our highest-level grouping (Country):</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-json codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"data"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"name"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"dataset"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"layer"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>"encoding"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"y"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Sales"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"aggregate"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"sum"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>"mark"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"type"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"bar"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"color"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"#d4d4d4"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"encoding"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token property" style=color:#36acaa>"x"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Country"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>"sort"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Sales"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"op"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"sum"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"order"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"descending"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token property" style=color:#36acaa>"y"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"type"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"quantitative"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre></div></div>
<ul>
<li>Note that I'm already thinking about the above approach by using a <code>layer</code> rather than a <code>mark</code> at the top level..</li>
<li>As our <code>y</code> encoding channel is <code>quantitative</code>, I'm putting that at the top level, and adding a <code>y</code> encoding channel by an aggregate of <strong>Sales</strong> in the layer (due to granularity). This will inherit the top-level <code>type</code> and we won't need to repeat this, due to how Vega-Lite will union the y-scale.</li>
<li>The <code>x</code> encoding channel will be shared by all layers, so this is at the top level. I'm also sorting this in descending order of <strong>Sales</strong> (again aggregated).</li>
</ul>
<p>Our design looks pretty normal right now, but as we might expect:</p>
<div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=step-2-lowest-level-grouping>Step 2: Lowest Level Grouping<a href=#step-2-lowest-level-grouping class=hash-link aria-label="Direct link to Step 2: Lowest Level Grouping" title="Direct link to Step 2: Lowest Level Grouping">â€‹</a></h2>
<p>With our primary channels (<code>x</code> and <code>y</code>) worked out, we can add our second layer, which will perform the offset within each bar, based on the <strong>Segment</strong> field:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-json codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"data"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"name"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"dataset"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"layer"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ... </span><span class="token comment" style=color:#999988;font-style:italic>// Our first layer</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>"encoding"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token property" style=color:#36acaa>"y"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Sales"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token property" style=color:#36acaa>"xOffset"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Segment"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token property" style=color:#36acaa>"sort"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Sales"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"order"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"descending"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token property" style=color:#36acaa>"scale"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"padding"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0.2</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token property" style=color:#36acaa>"color"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Segment"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token property" style=color:#36acaa>"sort"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Sales"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"order"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"descending"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>"mark"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"type"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"bar"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"stroke"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"white"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"encoding"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ... </span><span class="token comment" style=color:#999988;font-style:italic>// Our original encoding</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre></div></div>
<ul>
<li>This layer has the <code>y</code> encoding channel set the the <strong>Sales</strong> field.</li>
<li>Because we're at our lowest level of granularity, we don't need to aggregate this.</li>
<li>The <code>xOffset</code> channel is set to the <strong>Segment</strong> field, and we're sorting this in descending order of <strong>Sales</strong>. This will produce individual bars within each bigger bar, sharing the top-level <code>x</code> encoding channel for their corresponding <strong>Country</strong>. Theres a small amount of <code>padding</code> here, to help space them out a bit better.</li>
<li>The <code>color</code> channel is set to the <strong>Segment</strong> field, which will also give us our legend. This is sorted in descending order of sales, to match the ordering of the <code>xOffset</code> channel and having each legend item match the order of the segments in the chart.</li>
<li>Each bar has a white <code>stroke</code>, just to help with contrast against the bar behind it.</li>
</ul>
<p>As this point, we should be able to see that the main challenge has been solved and we have our "bars within bars" design:</p>
<div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=step-3-cleaning-up-the-plot-area>Step 3: Cleaning Up the Plot Area<a href=#step-3-cleaning-up-the-plot-area class=hash-link aria-label="Direct link to Step 3: Cleaning Up the Plot Area" title="Direct link to Step 3: Cleaning Up the Plot Area">â€‹</a></h2>
<p>For a more clutter-free design, we will need to remove the redundant elements from our chart. We will add labels in step 4, but this will help us to understand how much space we have to work with.</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-json codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"title"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"text"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Country Revenue by Segment ($M)"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"anchor"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"start"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"view"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"stroke"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"transparent"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"data"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"name"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"dataset"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"layer"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>"encoding"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"y"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Sales"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"aggregate"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"sum"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>"mark"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"type"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"bar"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"color"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"#d4d4d4"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>"encoding"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token property" style=color:#36acaa>"y"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Sales"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token property" style=color:#36acaa>"xOffset"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Segment"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token property" style=color:#36acaa>"sort"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Sales"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"order"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"descending"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token property" style=color:#36acaa>"scale"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"padding"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0.2</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token property" style=color:#36acaa>"color"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Segment"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token property" style=color:#36acaa>"sort"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Sales"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"order"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"descending"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">          </span><span class="token property" style=color:#36acaa>"legend"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"orient"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"top"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"title"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token null keyword" style=color:#00009f>null</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>"mark"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"type"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"bar"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"stroke"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"white"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"encoding"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token property" style=color:#36acaa>"x"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Country"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>"sort"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Sales"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"op"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"sum"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"order"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"descending"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>"axis"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token null keyword" style=color:#00009f>null</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">    </span><span class="token property" style=color:#36acaa>"y"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"type"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"quantitative"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"axis"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token null keyword" style=color:#00009f>null</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre></div></div>
<p>The changes have been highlighted in the code above but can be summarized as:</p>
<ul>
<li>Adding a title and anchoring it to the left (start).</li>
<li>Setting the <code>view</code> to have a transparent stroke, so we don't have a border around the plot area.</li>
<li>Setting the <code>legend</code> for the <strong>Segment</strong> field to be at the top, and removing the title (as it is redundant).</li>
<li>Removing both axes (setting them to <code>null</code>), as they are not needed.</li>
</ul>
<p>Here is our refined design:</p>
<div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=step-4-labels>Step 4: Labels<a href=#step-4-labels class=hash-link aria-label="Direct link to Step 4: Labels" title="Direct link to Step 4: Labels">â€‹</a></h2>
<p>For the last part of this walkthrough, I'm going to add labels for each bar using <code>text</code> marks. As our two-layer approach works well, we can use descendant layers so that these marks inherit what they need from the existing layout:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-json codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"title"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"text"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Country Revenue by Segment ($M)"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"anchor"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"start"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"view"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"stroke"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"transparent"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"data"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"name"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"dataset"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"transform"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"calculate"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"datum.Sales / 1000000"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"as"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Sales_M"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"layer"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>"encoding"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"y"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Sales"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"aggregate"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"sum"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>"layer"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"mark"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"type"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"bar"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"color"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"#d4d4d4"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">          </span><span class="token property" style=color:#36acaa>"mark"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"type"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"text"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"baseline"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"bottom"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"dy"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>-15</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">          </span><span class="token property" style=color:#36acaa>"encoding"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"text"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Country"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">          </span><span class="token property" style=color:#36acaa>"mark"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"type"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"text"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"baseline"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"top"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"dy"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>-15</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">          </span><span class="token property" style=color:#36acaa>"encoding"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">            </span><span class="token property" style=color:#36acaa>"text"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Sales_M"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"aggregate"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"sum"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"format"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>",d"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">          </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">      </span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>"encoding"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token property" style=color:#36acaa>"y"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Sales"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token property" style=color:#36acaa>"xOffset"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Segment"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token property" style=color:#36acaa>"sort"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Sales"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"order"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"descending"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token property" style=color:#36acaa>"scale"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"padding"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0.2</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>"layer"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">          </span><span class="token property" style=color:#36acaa>"mark"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"type"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"bar"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"stroke"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"white"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">          </span><span class="token property" style=color:#36acaa>"encoding"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">            </span><span class="token property" style=color:#36acaa>"color"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">              </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Segment"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">              </span><span class="token property" style=color:#36acaa>"sort"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Sales"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"order"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"descending"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">              </span><span class="token property" style=color:#36acaa>"legend"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"orient"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"top"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"title"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token null keyword" style=color:#00009f>null</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">            </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">          </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">          </span><span class="token property" style=color:#36acaa>"mark"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"type"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"text"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"dy"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>-7.5</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">          </span><span class="token property" style=color:#36acaa>"encoding"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"text"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Sales_M"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"format"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>",d"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">      </span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"encoding"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token property" style=color:#36acaa>"x"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Country"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>"sort"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"field"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"Sales"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"op"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"sum"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"order"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"descending"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token property" style=color:#36acaa>"axis"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token null keyword" style=color:#00009f>null</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token property" style=color:#36acaa>"y"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"type"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"quantitative"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"axis"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token null keyword" style=color:#00009f>null</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre></div></div>
<p>I've again highlighted the lines that have changed, but an overview of what I've done is as follows:</p>
<ul>
<li>
<p>Added a <code>transform</code> to calculate the <strong>Sales</strong> measure in millions, and store it in a new field called <strong>Sales_M</strong>. This is used for the labels. We could do this using Power BI formatting against the <strong>Sales</strong> measure, but I'm trying to keep things replicable in Vega-Lite outside Power BI for this example.</p>
</li>
<li>
<p>Created a sub-layer in the first layer, for three marks:</p>
<ul>
<li>Our original <code>bar</code> mark, which is the grey bar for the <strong>Country</strong> field.</li>
<li>A <code>text</code> mark for the <strong>Country</strong> field, offset by <code>dy</code> by -15 pixels (upwards).</li>
<li>A <code>text</code> mark for the (aggregated) <strong>Sales_M</strong> field, offset by <code>dy</code> -by 15 pixels (upwards).</li>
</ul>
<p>Both <code>text</code> marks have opposing <code>baseline</code> properties, so while they share the same <code>y</code> position and <code>offset</code>, they will be positioned above and below their resolved y-position accordingly.</p>
</li>
<li>
<p>The second layer has a similar approach to the first, where we create a sub-layer for two marks:</p>
<ul>
<li>The <code>bar</code> mark, which is the colored bar for the <strong>Segment</strong> field. We have also moved the <code>color</code> encoding for the layer into this sub-layer, so that the <code>text</code> marks do not inherit it.</li>
<li>A <code>text</code> mark for the <strong>Sales_M</strong> field, offset by <code>dy</code> by -7.5 pixels (upwards).</li>
</ul>
</li>
</ul>
<p>And now we have a visual that looks like what we intended:</p>
<div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=wrapping-up>Wrapping Up<a href=#wrapping-up class=hash-link aria-label="Direct link to Wrapping Up" title="Direct link to Wrapping Up">â€‹</a></h2>
<p>I'm really grateful for Sebastine, Darragh and Kevin for taking the time to write up such a wonderful study on this approach and sharing their techniques with the data visualization community, and I hope that this implementation does that some justice, and help folks to implement this design in other tools. Hopefully anyone reading may have learned a little bit more about what Vega-Lite can do (and how Deneb can help you to achieve similar results in Power BI).</p>
<p>As promised, here are some links to the finished recipe:</p>
<ul>
<li><a href="/assets/files/Deneb - Stacked Bar Alternative-ce64280ee628fe47b276c1e000e02514.pbix" target=_blank>Power BI workbook (with visual)</a></li>
<li><a href="/assets/files/Stacked Bar Chart Alternative.deneb-52f8b086155a624eaaef20973fd8d67b.json" target=_blank>Deneb template</a></li>
<li><a href=https://vega.github.io/editor/#/url/vega-lite/N4IgJAzgxgFgpgWwIYgFwhgF0wBwqgegIDc4BzJAOjIEtMYBXAI0poHsDp5kTykBaADZ04JAGyUAVhDYA7EABoQAEySYkEOJghpQq9ZsxoA2qADCbBrMwAnAJ5oQZpLKSrFIAMrkEca47MYF1k4QQACAAUkG0wQmx0lTyRBOB1UAEYATgB2AFYAJgAWMQAOAF8Fc0trewCXNxREnz8jdABRazgbHBsaTQ8klLT0wsK8-OyAZjEKqqtbB3RnV3cmsl9-dABxNlIbWQ2jROTUtEL8kpL8zJLJydmnaoW6lcavZs2QAFkaZWQbADWWgGJzS+XSYghmUKAAYHhZ5rUlvVVu91i1HJ5kIJwgAhBgQGghCAJLygtDTdL5GGTbKZfLwp5IkAAMRsLigcAGH1aTiCshC4SiMTipMGpwyuXS2RKVMKjMRi1Z7NknO56M+HUwXR6fS5xyGaHSuRh6Su2Xy90qj0VjjZHP1aMOjh2ewOGINEsKkwm9MmOQVNSV9tVju8Gt5Pz+0SBRzJhtQ+Vy-tymSygee6BDarWzvQWOSeIJRNSYvJieysMmhRKuRm1oRQZdXWQsgcuYxS35gsi0ViXTLCZuMOyYmpGeZWxbLnbTs7IC1Ot6-U9w2K0yThUyE6VU5srdn4bzIFdXXd-lXFJH2SmNdyO+b+5n6uPUf+sZBCblBVyhXvDaZXdpzbF95wLHEwnxQliUHCULmla4R23ADbXQL44AADxoKA2FAz5AmCUJexFAdPwlS4ShlJMHzQzDsNwjtNU6bplzDct0kmGFMjEGk6xo746JwvDeVPfZnUvVBCg4kp6STf85ibWisKExjI1+d9gQkiFzkovJ+PQ5SGLnT5wKLaDSzItJOMuaypX4gBVWQRGUMJPHUbUIDCNgADMwgAQV8XooDeI95wIgUiOFft4kso1qVTP9yhQxSQEc5zXPc1IvN8gKumwkKeUcRcWL1WKMjEUpoTHeVkszVKnO1Fy3LULKfP8wL8uEl1djPcT4wlDcRjHTJkIUuq0sajKWs8trcqCgqI0cN8Y00-qwTNTIYQKGqxuZCa4CazKZpyjrgq6-NsTMksSTK9dpR4ziygAXQqEAAHdfnoNBchKGElHgGgyCwCkeKUTA6BSXQQG1DDeUbBYwgAJTgUhZAYOAwiYOxXJ5MIAAowC+ABKDwORgNgbEcCB1BiEBXuIGg4DeqHqZsNggUcWwXAgHBogxV79BQVBQFcXxHEFww6bBlUIG8imEBMUBgsEKAGEEFrxbUBgEEocVPIIMJ0hhY2TdJtI1oAfS+OmnqUdW7C6RWQD8HDlCJMgocWUBvMZwRlExcklCQMgyBsPhtSp7W6de+3HdQUwQHfKHMDsHAuXQJhog8HDBApxwAGJlEKIui+j60k+F6HU-T6HMLjTPNGEEJHCYNhsDYBWlGURZ+GNV6XbYN3ZA9yuYdab3ff9pZAOjh4K9AFO085uuPAb0IS05tgcA8bu0F7-9ndVQf3eTlfK590Ip8t62g5DsOKAj9AICjpQ5afXkFH9spv5e60B6HkeoAvYgAvn7AOhpXoYQAPLeW8pLc+k9MSFSUDIWmCDL7gNOEoCmyg44qFSJyWQACpYgGgCcKGvNlDENQDCSgDJv52yQA7Sm8dQDzyrkvDOWcUG2HZjXN6MARAkP-ifSuOc87oLAfmZBpCKbjxAYg-MgcQA4Lwbg6AfhiEx3IJoqGFNGafEwFvDw4NMCQ1QGjHE38GFsJjMnauy9YY7x7tkSgB8RHD1Pk4yRV89ZWw8G-ZAH8v4-2ekoDxgCQAYShqAq+8NagoLkTExRa0PDGKfi-FRNhcEsPwRoohJ9XpICwmkSxghXrAMXjXAAjgwFwpi1A0FIKTEpaAynWKAA target=_blank rel="noopener noreferrer">Version in Vega Editor</a></li>
</ul>
<p>Thanks as always for reading!</p>
<p>DM-P</div><footer class=docusaurus-mt-lg><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class=col><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/blog/tags/how-to>how-to</a><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/blog/tags/vega-lite>vega-lite</a></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href=/blog/sample-workbook-update><div class=pagination-nav__sublabel>Newer post</div><div class=pagination-nav__label>New AppSource Sample Workbook</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/blog/2024-2025-summary><div class=pagination-nav__sublabel>Older post</div><div class=pagination-nav__label>Deneb Annual Round-Up</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#finished-recipe class="table-of-contents__link toc-highlight">Finished Recipe</a><li><a href=#our-data class="table-of-contents__link toc-highlight">Our Data</a><li><a href=#thinking-about-our-design class="table-of-contents__link toc-highlight">Thinking About Our Design</a><li><a href=#step-1-highest-level-grouping class="table-of-contents__link toc-highlight">Step 1: Highest Level Grouping</a><li><a href=#step-2-lowest-level-grouping class="table-of-contents__link toc-highlight">Step 2: Lowest Level Grouping</a><li><a href=#step-3-cleaning-up-the-plot-area class="table-of-contents__link toc-highlight">Step 3: Cleaning Up the Plot Area</a><li><a href=#step-4-labels class="table-of-contents__link toc-highlight">Step 4: Labels</a><li><a href=#wrapping-up class="table-of-contents__link toc-highlight">Wrapping Up</a></ul></div></div></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Documentation</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/docs>Docs</a><li class=footer__item><a href=https://vega.github.io/vega/docs/ target=_blank rel="noopener noreferrer" class=footer__link-item>Vega Documentation<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://vega.github.io/vega-lite/docs/ target=_blank rel="noopener noreferrer" class=footer__link-item>Vega-Lite Documentation<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Community</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/community/resources>Resources and Examples</a><li class=footer__item><a class=footer__link-item href=/support>Support</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>More</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/privacy-policy>Privacy Policy</a><li class=footer__item><a class=footer__link-item href=/blog>Blog</a><li class=footer__item><a href=https://github.com/sponsors/deneb-viz target=_blank rel="noopener noreferrer" class=footer__link-item>Sponsor<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://github.com/deneb-viz/deneb target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Deneb is released under the MIT License.</div></div></div></footer></div>